<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Calculator</title>
    <link rel="stylesheet" type="text/css" href="./style.css">
</head>
<body>
    <div id='calc-container'>
        <div id='value-container'>
            <div id='expression'></div>
            <div id='value'>0</div>
        </div>
    </div>
    <script type="module">
        import { MathCalculator } from './calculator/math-calculator/math-calculator.js'

        let calc = new MathCalculator();
        
        let onUpdateFunc = (calc) => {
            document.querySelector('#expression').textContent = calc.operationsToDisplay;
            document.querySelector('#value').textContent = calc.valueToDisplay;
        };

        putButtons(document.querySelector('#calc-container'), calc.operations, onUpdateFunc);
        setKeyboardEvents(calc.operations, onUpdateFunc);

        function putButtons(container, operations, onUpdate, options = { className: 'operation-button'}) {
            
            let button;
            for (let operation of operations) {
                button = document.createElement('button');
                button.addEventListener('click', () => {
                    calc.performOperation(operation);
                    onUpdate(calc);
                });
                button.name = operation.name;
                button.textContent = operation.symbol;
                button.style.gridArea = operation.name;
                button.className = options.className;
                container.append(button);
            }
        }

        function setKeyboardEvents(operations, onUpdate) {

            document.addEventListener('keydown', (event) => {

                for (let operation of operations) {
                    
                        if (operation.keyCodes && operation.keyCodes.indexOf(event.code) !== -1) {
                            calc.performOperation(operation);
                            onUpdate(calc);
                        }
                }
            });
        }
    </script>
</body>
</html>